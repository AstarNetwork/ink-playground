FROM ink-env:1

RUN set -eux;\
    mkdir /projects; \
    cd /projects; \
    cargo contract new sample; \
    cd sample; \
    ./build.sh; \
    cargo +nightly build --features ink-generate-abi; \
    rm target/sample* target/old_abi.json src/lib.rs; 

WORKDIR /projects/sample

CMD cp -f /share/lib.rs src/lib.rs; \
    ./build.sh; \
    cargo +nightly build --features ink-generate-abi; \
    tar -cvzf target.tgz target/sample* target/old_abi.json; \
    cp -f target.tgz /share;
